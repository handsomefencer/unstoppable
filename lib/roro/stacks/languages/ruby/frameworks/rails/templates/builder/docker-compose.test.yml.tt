x-test: &test 
  build:
    dockerfile: ./mise/containers/app/Dockerfile.test
  env_file: 
    - ./mise/containers/app/env/base.env
    - ./mise/containers/app/env/test.env
  image: <%= @env[:base][:app_name][:value] %>/test
  shm_size: '256mb' 
  stdin_open: true
  tmpfs:
    - /tmp
  tty: true
  user: root
  volumes:
<%= section('app_volume_mappings') %>

services:
  test:
    <<: *test
    command: ["bin/rails", "test:all"]
    
