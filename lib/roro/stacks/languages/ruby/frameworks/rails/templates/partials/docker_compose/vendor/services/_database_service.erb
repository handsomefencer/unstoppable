  db:
    container_name: db
    image: <%= @env.dig(:base, :db_image, :value) %>:<%= @env.dig(:base, :db_image_tag, :value) %>
    env_file:
      - ./mise/containers/db/env/development.env
    volumes:
      - db_data:<%= @env.dig(:base, :db_volume, :value) %>
    healthcheck:
      test: ["CMD", "mysqladmin", "-u$$MYSQL_USER", "-p$$MYSQL_PASSWORD",  "ping", "-h", "db"]
      # test: ["CMD-SHELL", "mysql -h ${MYSQL_HOST} -u  ${MYSQL_ROOT_USER} -p$$MYSQL_ROOT_PASSWORD" ]
      interval: 5s
      timeout: 5s
      retries: 5
    ports:
      - "<%= @env[:base][:db_service_port][:value] %>"
    profiles:
      - development
      - test
    restart: always
